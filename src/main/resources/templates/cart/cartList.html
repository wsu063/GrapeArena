<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
  
  <head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  </head>
  
  <th:block layout:fragment="css">
    <style>
      /* 스타일 정의 */
    </style>
  </th:block>
  
  <div layout:fragment="content">
    <div class="bg-light py-3" style="margin-top: 2rem;">
      <div class="container">
        <div class="row">
          <div class="col-md-12 mb-0">
            <a href="/" style="text-decoration-line: none; color: #ffc107;">Home</a>
            <span class="mx-2 mb-0">/</span>
            <strong class="text-black">MD Cart</strong>
          </div>
        </div>
      </div>
    </div>
    
    <div class="site-section" style="margin-top: 1rem;">
      <div class="container">
        <div class="row mb-5">
          <form class="col-md-12" method="post">
            <div class="site-blocks-table">
              <table class="table table-bordered" style="text-align: center;">
                <thead>
                  <tr>
                    <th class="product-remove">
                      <input type="checkbox" id="checkall" onclick="checkAll()"/> 전체선택
                    </th>
                    <th class="product-thumbnail">이미지</th>
                    <th class="product-name">상품명</th>
                    <th class="product-price">가격</th>
                    <th class="product-quantity">수량</th>
                    <th class="product-total">총금액</th>
                    <th class="product-remove">삭제</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- 장바구니 항목들을 순회하며 출력 -->
                  <tr th:each="cart : ${goodsCarts}">
                    <td colspan="7">
                      <table style="width: 100%;">
                        <tr th:each="goodsCart : ${cart.goodsCartDtoList}">
                        <!-- 각 장바구니 항목의 상품들을 순회하며 출력 -->
                          <td class="product-remove">
                            <input type="checkbox" name="cartChkBox" th:value="${goodsCart.goodsId}"/>
                          </td>
                          <td class="product-thumbnail">
                            <img th:src="${goodsCart.imgUrl}" class="img-fluid" th:alt="${goodsCart.goodsName}">
                          </td>
                          <td class="product-name">
                            <span th:text="${goodsCart.goodsName}"></span>
                          </td>
                          <td>
                             <span th:id="'price_' + ${goodsCart.goodsId}"
                               th:data-price="${goodsCart.goodsPrice}"
                               th:text="${#numbers.formatInteger(goodsCart.goodsPrice, 0, 'COMMA')} + '원'">
                             </span>
                          </td>
                          <td>
                            <div class="input-group mb-3" style="max-width: 120px;">
                              <div class="input-group-prepend">
                                <button class="btn btn-outline-primary js-btn-minus" id="minus" type="button">&minus;</button>
                              </div>
                              <input type="text" class="form-control text-center"
                                     id="quantity"
                                     th:value="${goodsCart.goodsCount}" placeholder=""
                                     aria-label="Example text with button addon" aria-describedby="button-addon1">
                              <div class="input-group-append">
                                <button class="btn btn-outline-primary js-btn-plus" id="plus" type="button">&plus;</button>
                              </div>
                            </div>
                          </td>
                          <td>
                            <span th:id="'totalPrice_' + ${goodsCart.goodsId}"
                                  name="totalPrice"
                                  th:text="${#numbers.formatInteger(goodsCart.goodsPrice * goodsCart.goodsCount, 0, 'COMMA')} + '원'">
                            </span>
                          </td>
                          <td>
                            <a href="#" th:data-id="${goodsCart.goodsId}" onclick="deleteGoodsCart(this); return false;"
                               class="btn btn-primary height-auto btn-sm">X</a>
                          </td>
                        </tr>
                       
                      </table>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          
          </form>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <!-- 추가 내용 -->
          </div>
          <div class="col-md-6 pl-5">
            <div class="row justify-content-end">
              <div class="col-md-7">
                <div class="row">
                  <div class="col-md-12 text-right border-bottom mb-5">
                    <h3 class="text-black h4 text-uppercase">Cart Totals</h3>
                  </div>
                </div>
                <div class="row mb-5">
                  <div class="col-md-6">
                    <span class="text-black">총 상품금액</span>
                  </div>
                  <div class="col-md-6 text-right">
                    <strong class="text-black"><span id="orderTotalPrice" class="text-danger">0원</span></strong>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-12">
                    <button class="btn btn-success btn-lg btn-block" onclick="orders()">주문하기</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <th:block layout:fragment="script">
    <script th:inline="javascript">
      $(document).ready(function() {
        var pricePerItem = parseInt([[${goods.goodsPrice}]]);
        var maxAmount =  parseInt([[${goods.goodsMaxAmount}]]);
        var quantity = parseInt([[${goodsCart.goodsCount}]]);
        
        function updateTotalPrice() {
          var totalPrice = pricePerItem * quantity;
          $('#total_price').text('￦' + totalPrice.toLocaleString('ko-KR'));
          $('#total_price2').text('￦' + totalPrice.toLocaleString('ko-KR'));
        }
        
        $('.plus').click(function() {
          if (quantity < maxAmount) {
            quantity++;
            $('#quantity_value').text(quantity);
            updateTotalPrice();
          } else {
            alert('최대 수량은 ' + maxAmount + '개입니다.');
          }
        });
        
        
        $('.minus').click(function() {
          if (quantity > 1) {
            quantity--;
            $('#quantity_value').text(quantity);
            updateTotalPrice();
          }
        });
        
        updateTotalPrice();
      });
      
      
      
      // JavaScript 함수 및 이벤트 핸들러
      function checkAll() {
        if ($("#checkall").prop("checked")) {
          $("input[name=cartChkBox]").prop("checked", true);
        } else {
          $("input[name=cartChkBox]").prop("checked", false);
        }
      }
      
      function deleteGoodsCart(element) {
        let goodsId = $(element).data("id");
        console.log("Deleting goods with ID:", goodsId);
        // 실제 삭제 요청 로직을 추가
      }
      
      function orders() {
        console.log("Order button clicked");
        // 주문 처리 로직을 추가
      }
    </script>
  </th:block>
</html>
